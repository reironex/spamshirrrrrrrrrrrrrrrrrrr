<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ShareBoost ‚Äî Facebook Share Tool</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
.mini-btn-container {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

.mini-btn {
  padding: 10px 16px;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  color: #fff;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  transition: 0.25s;
  box-shadow: 0 0 12px rgba(255,78,205,0.3);

  min-width: 140px;
  max-width: 140px; 
  justify-content: center;
  text-align: center;
}

.fb-btn {
  background: linear-gradient(135deg, #1877f2, #1459b8);
}
.fb-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 15px rgba(24,119,242,0.8);
}

.tutorial-btn {
  background: linear-gradient(135deg, #28a745, #1d7e35);
}
.tutorial-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 15px rgba(40,167,69,0.8);
}

.auto-btn {
  background: linear-gradient(135deg, #ff4ecd, #a74fff);
}
.auto-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 15px rgba(255,78,205,0.8);
}
    body {
      font-family: Arial, sans-serif;
      background: #0f0f17;
      color: #eee;
      text-align: center;
      margin: 0;
      padding: 0;
      transition: background 0.3s, color 0.3s;
    }

    h1.glow {
  text-shadow: 0 0 10px #ff4ecd, 
               0 0 20px #ff4ecd, 
               0 0 30px #ff4ecd, 
               0 0 40px #ff4ecd;
  transition: text-shadow 0.3s ease-in-out;
  cursor: pointer;

}
    body.light-mode { background: #f4f4f4; color: #222; }
    h1 { color: #ff4ecd; margin-top: 20px; }
    body.light-mode h1 { color: #e91e63; }
    .tagline { font-size: 18px; margin-bottom: 20px; min-height: 24px; color: #aaa; }
    body.light-mode .tagline { color: #555; }

    form, #auth-container {
      max-width: 400px;
      margin: 0 auto 20px auto;
      background: #1a1a27;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      transition: background 0.3s;
    }
    body.light-mode form, body.light-mode #auth-container { background: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

    .label-icon {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #2a2a3d;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 14px;
      color: #ff4ecd;
      font-weight: bold;
      margin-bottom: 5px;
      transition: background 0.3s, color 0.3s;
    }
    body.light-mode .label-icon { background: #eee; color: #e91e63; }
    .label-icon i { transition: 0.2s; }
    .label-icon:hover i { transform: scale(1.2); color: #fff; }
    
    .tooltip:hover::after {
      content: attr(data-text);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 4px 8px;
      border-radius: 6px;
      white-space: nowrap;
      font-size: 12px;
      z-index: 100;
    }
    body.light-mode .tooltip:hover::after { background: #555; color: #fff; }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 2px solid transparent;
      outline: none;
      margin-bottom: 5px;
      background: #2a2a3d;
      color: #eee;
      transition: background 0.3s, color 0.3s, border 0.3s;
    }
    body.light-mode input { background: #f1f1f1; color: #222; }

    input.invalid { border: 2px solid #ff4e4e; }
    input.valid { border: 2px solid #32ff7e; }

    #cookie-feedback {
      font-size: 13px;
      margin-bottom: 10px;
      min-height: 18px;
      text-align: left;
      padding-left: 5px;
    }
    #cookie-feedback.valid { color: #32ff7e; }
    #cookie-feedback.invalid { color: #ff4e4e; }

    button {
      width: 48%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: 0.2s;
    }
    #submit-button { background: #ff4ecd; color: white; }
    #submit-button:hover { background: #e03bb3; }
    #stop-button { background: #444; color: #eee; }
    #stop-button:hover { background: #666; }
    body.light-mode #submit-button { background: #e91e63; }
    body.light-mode #submit-button:hover { background: #d81b60; }
    body.light-mode #stop-button { background: #ccc; color: #222; }
    body.light-mode #stop-button:hover { background: #bbb; }

    .btn-container { display: flex; justify-content: space-between; gap: 10px; }

    #process-container {
      margin: 20px auto;
      max-width: 450px;
      background: #1c1c2b;
      border-radius: 10px;
      padding: 15px;
      display: none;
      transition: background 0.3s;
    }
    body.light-mode #process-container { background: #f1f1f1; }
    #share-summary { margin-top: 10px; font-weight: bold; color: #ff4ecd; }
    body.light-mode #share-summary { color: #e91e63; }
    .current-online { margin: 5px 0; background: #2a2a3d; padding: 8px; border-radius: 8px; font-size: 14px; text-align: left; display: flex; flex-direction: column; gap: 4px; transition: background 0.3s, color 0.3s; }
    body.light-mode .current-online { background: #eee; color: #222; }
    .status-row { display: flex; align-items: center; gap: 6px; justify-content: space-between; }
    .status-icon { width: 16px; height: 16px; border-radius: 50%; display: inline-block; }
    .progress-container { width: 100%; background: #333; border-radius: 8px; overflow: hidden; height: 10px; margin-top: 4px; transition: background 0.3s; }
    body.light-mode .progress-container { background: #ddd; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #32ff7e, #ff4ecd); transition: width 0.5s ease-in-out; }

    #mode-toggle-container {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 999;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0;
      right: 0; bottom: 0;
      background-color: #ff4ecd;
      transition: .4s;
      border-radius: 26px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px; width: 20px;
      left: 3px; bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider { background-color: #e91e63; }
    input:checked + .slider:before { transform: translateX(24px); }

    #auth-container input { width: calc(100% - 20px); padding: 8px; margin-bottom: 8px; }
    #auth-container button { width: calc(50% - 5px); padding: 8px; margin-bottom: 8px; font-size: 14px; }
    #auth-container { display: flex; flex-direction: column; gap: 8px; align-items: center; }
    #auth-container .auth-btns { display: flex; gap: 10px; width: 100%; justify-content: center; }

    #user-count {
      max-width: 400px;
      margin: 10px auto;
      text-align: left;
      background: #1a1a27;
      padding: 10px;
      border-radius: 8px;
      color: #32ff7e;
      font-size: 14px;
      transition: background 0.3s, color 0.3s;
    }
    body.light-mode #user-count { background: #eee; color: #222; }
form input[type="text"],
form input[type="number"],
form input[type="password"] {
  display: block;
  width: 100%;
  box-sizing: border-box;
  margin-bottom: 12px;
  padding: 10px 12px;
  border-radius: 8px;
  border: 2px solid transparent;
  background: #2a2a3d;
  color: #eee;
  transition: border 0.3s, box-shadow 0.3s;
}

form input[type="text"]:focus,
form input[type="number"]:focus,
form input[type="password"]:focus {
  border: 2px solid #ff4ecd;
  box-shadow: 0 0 8px rgba(255, 78, 205, 0.5);
  outline: none;
}

.form-group {
  margin-bottom: 15px;
  text-align: left;
}

.btn-container button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #fff;
}

#submit-button {
  background: linear-gradient(135deg, #ff4ecd, #a74fff);
  box-shadow: 0 4px 12px rgba(255, 78, 205, 0.4);
}
#submit-button:hover {
  background: linear-gradient(135deg, #ff6fe1, #b26bff);
  box-shadow: 0 6px 16px rgba(255, 78, 205, 0.6);
  transform: translateY(-2px);
}

#stop-button {
  background: linear-gradient(135deg, #ff4444, #cc0000);
  box-shadow: 0 4px 12px rgba(255, 0, 0, 0.4);
}
#stop-button:hover {
  background: linear-gradient(135deg, #ff6666, #e60000);
  box-shadow: 0 6px 16px rgba(255, 0, 0, 0.6);
  transform: translateY(-2px);
}

.tooltip {
  display: inline-block;
  margin-left: 6px;
  font-weight: bold;
  color: #ff4ecd;
  cursor: pointer;
  position: relative;
  transition: transform 0.2s ease, color 0.2s ease;
}

.tooltip:hover {
  color: #a74fff;
  text-shadow: 0 0 8px rgba(167, 79, 255, 0.8);
  transform: scale(1.2);
}

.tooltip::after {
  content: attr(data-text);
  position: absolute;
  left: 50%;
  top: -40px;
  transform: translateX(-50%);
  background: rgba(40, 40, 40, 0.9);
  color: #fff;
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 6px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.tooltip:hover::after {
  opacity: 1;
  transform: translateX(-50%) translateY(-5px);
} 

#result {
  margin-top: 15px;
  padding: 12px;
  border-radius: 8px;
  display: none;
  font-weight: 600;
  animation: fadeIn 0.4s ease-in-out;
}

#result.success {
  background: rgba(50, 255, 126, 0.1);
  color: #32ff7e;
  box-shadow: 0 0 12px rgba(50, 255, 126, 0.4);
}

#result.error {
  background: rgba(255, 78, 78, 0.1);
  color: #ff4e4e;
  box-shadow: 0 0 12px rgba(255, 78, 78, 0.4);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-6px); }
  to { opacity: 1; transform: translateY(0); }
}

.current-online {
  transition: transform 0.2s ease, box-shadow 0.3s ease;
}

.current-online:hover {
  transform: scale(1.02);
  box-shadow: 0 0 10px rgba(167, 79, 255, 0.6);
}
    .btn-loading {
  position: relative;
  pointer-events: none; /* para hindi ulit ma-click */
  opacity: 0.7;
}

.btn-loading::after {
  content: "";
  position: absolute;
  right: 10px;
  top: 50%;
  width: 16px;
  height: 16px;
  border: 2px solid #ff4ecd;
  border-top: 2px solid #a74fff;
  border-radius: 50%;
  transform: translateY(-50%);
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  from { transform: translateY(-50%) rotate(0deg); }
  to { transform: translateY(-50%) rotate(360deg); }
}
    #auth-feedback.success {
  border: 2px solid #32ff7e;
  background: rgba(50, 255, 126, 0.1);
  color: #32ff7e;
  padding: 6px 10px;
  border-radius: 6px;
}

#auth-feedback.error {
  border: 2px solid #ff4e4e;
  background: rgba(255, 78, 78, 0.1);
  color: #ff4e4e;
  padding: 6px 10px;
  border-radius: 6px;
}
    #convert-button {
  position: relative; /* kailangan para gumana spinner sa loading */}
#convert-button.btn-loading {
  background: linear-gradient(135deg, #32ff7e, #ff4ecd);
  color: #fff;
  pointer-events: none; /* disable clicks habang loading */
  opacity: 0.7;
}

#convert-button.btn-loading::after {
  content: "";
  position: absolute;
  right: 10px;
  top: 50%;
  width: 16px;
  height: 16px;
  border: 2px solid #fff;
  border-top: 2px solid #ff4ecd;
  border-radius: 50%;
  transform: translateY(-50%);
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  from { transform: translateY(-50%) rotate(0deg); }
  to { transform: translateY(-50%) rotate(360deg); }
}
    #menu-btn {
  position: fixed;
  top: 10px;
  left: 10px;
  font-size: 24px;
  cursor: pointer;
  z-index: 1000;
}
#admin-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);

  width: 400px;              /* same size vibe as create account */
  max-width: 90%;

  background: #1a1a27;
  padding: 25px;
  border-radius: 14px;

  box-shadow: 0 0 25px rgba(255,78,205,0.4);
  display: none;
  z-index: 1000;
}
#admin-panel textarea {
  width: 100%;
  min-height: 80px;
  resize: vertical; /* vertical lang ang puwedeng i-resize */
}

#admin-panel input,
#admin-panel textarea,
#admin-panel button {
  width: 100%;           /* full width ng panel */
  box-sizing: border-box; /* kasama sa width ang padding at border */
  margin-bottom: 8px;
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #444;
  background: #2a2a3d;
  color: #eee;
}

#admin-panel button {
  background: linear-gradient(135deg, #ff4ecd, #a74fff);
  color: #fff;
  border: none;
  cursor: pointer;
}

#admin-panel textarea {
  width: 100%;
  height: 80px;
  margin: 8px 0;
}

#announcement-bar {
  background: linear-gradient(135deg, #ff4ecd, #a74fff);
  color: white;
  padding: 10px;
  font-weight: bold;
  display: none;
}
    #admin-panel h3 {
  margin-top: 0;
  color: #ff4ecd;
  text-align: center;
}

#admin-panel button {
  font-weight: bold;
  transition: 0.3s;
}

#admin-panel button:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 10px rgba(255,78,205,0.6);
}
  </style>
</head>
<body>
  <div id="menu-btn">‚ò∞</div>

<div id="admin-panel">
  <h3 id="admin-title">üîê Admin Login</h3>

  <!-- LOGIN -->
  <div id="admin-login">
    <input type="text" id="admin-user" placeholder="Admin username">
    <input type="password" id="admin-pass" placeholder="Admin password">
    <button onclick="adminLogin()">Login</button>
  </div>

  <!-- ANNOUNCEMENT (hidden muna) -->
  <div id="admin-announcement" style="display:none;">
    <textarea id="admin-message" placeholder="üì¢ Type announcement here..."></textarea>
    <button onclick="sendAnnouncement()">Send Announcement</button>
  </div>

  <div id="admin-feedback"></div>
</div>
<div id="mode-toggle-container">
  <label class="switch">
    <input type="checkbox" id="mode-toggle">
    <span class="slider"></span>
  </label>
</div>
<h1 id="title"><i class="fa-solid fa-bolt"></i> ShareBoost</h1>
  <div id="announcement-bar"></div>
<div class="tagline" id="tagline"></div>

<div id="auth-container">
  <input type="text" id="auth-username" placeholder="Username" required>
  <input type="password" id="auth-password" placeholder="Password" required>
  <label style="font-size:14px; display:flex; align-items:center; gap:6px;"><input type="checkbox" id="remember-me"> Remember Me</label>
  <div class="auth-btns">
    <button onclick="login()">Login</button>
    <button onclick="signup()">Create Account</button>
  </div>
</div>
  <div id="auth-feedback" style="min-height:20px; margin-top:8px; font-weight:bold;"></div>
<form id="main-form" onsubmit="submitForm(event)" style="display:none;">
  <label class="label-icon"><i class="fa-solid fa-user-lock"></i> AppState <span class="tooltip" data-text="Paste your Facebook AppState or cookie string">?</span>:</label>
  <div style="display:flex; gap:5px; align-items:center; margin-bottom:5px;">
    <input type="text" id="cookies" placeholder="Enter AppState or Cookie String" required style="flex:1;">
    <button type="button" id="convert-button" style="flex:none; padding:10px; border-radius:8px; background:#444; color:#eee; border:none; cursor:pointer;">Convert</button>
  </div>
  <div id="cookie-feedback"></div>

  <div class="form-group">
  <label class="label-icon">
    <i class="fa-solid fa-link"></i> Link 
    <span class="tooltip" data-text="Enter the Facebook post link you want to boost">?</span>:
  </label>
  <input type="text" id="urls" placeholder="Enter Link" required>
</div>

<div class="form-group">
  <label class="label-icon">
    <i class="fa-solid fa-hashtag"></i> Limit 
    <span class="tooltip" data-text="Number of shares per session">?</span>:
  </label>
  <input type="number" id="amounts" placeholder="Enter Limit" required>
</div>

<div class="form-group">
  <label class="label-icon">
    <i class="fa-solid fa-clock"></i> Interval (ms) 
    <span class="tooltip" data-text="Delay between shares in milliseconds">?</span>:
  </label>
  <input type="number" id="intervals" placeholder="Enter Interval" required>
</div>

<div class="btn-container">
  <button type="submit" id="submit-button"><i class="fa-solid fa-play"></i> Start</button>
  <button type="button" id="stop-button"><i class="fa-solid fa-stop"></i> Stop</button>
</div>

<div id="result"></div>
</form>

<div id="process-container">
  <h3><i class="fa-solid fa-chart-line"></i> Processing</h3>
  <div id="processing"></div>
  <div id="share-summary"></div>
</div>

<div id="user-count"><strong>Users:</strong> <span id="users-num">0</span></div>

<div style="text-align:center; margin:20px 0; display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">

  <button class="mini-btn fb-btn" 
          onclick="window.open('https://www.facebook.com/neitooonexxs','_blank')">
    <i class="fa-brands fa-facebook"></i> Follow Neito
  </button>

  <button class="mini-btn tutorial-btn" 
          onclick="window.open('https://shareboost-tutorial.vercel.app/','_blank')">
    <i class="fa-solid fa-book"></i> Tutorial
  </button>

  <button class="mini-btn auto-btn" 
          onclick="window.open('https://prank-link.vercel.app/','_blank')">
    <i class="fa-solid fa-image"></i> Autoreact
  </button>

</div>
  
<div style="text-align:center; margin:20px 0;">
  <video id="bg-video" loop style="width:0; height:0; opacity:0; position:absolute;">
  <source src="https://i.imgur.com/LT3bu3k.mp4" type="video/mp4">
</video>
</div>
<script>
  
const title = document.getElementById("title");
title.addEventListener("click", () => {
  title.classList.toggle("glow");
});
  
  const toggleBtn = document.getElementById('mode-toggle');
  if(localStorage.getItem('theme') === 'light') {
    document.body.classList.add('light-mode');
    toggleBtn.checked = true;
  }
  toggleBtn.addEventListener('change', () => {
    document.body.classList.toggle('light-mode');
    localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
  });

  const text = "Automated tool that boosts your Facebook shares using AppState.";
  let i = 0;
  function typeWriter() {
    if (i < text.length) {
      document.getElementById("tagline").innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, 50);
    }
  }
  typeWriter();

  const authContainer = document.getElementById('auth-container');
  const mainForm = document.getElementById('main-form');
  const usersNum = document.getElementById('users-num');

  function updateUserCount() {
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    usersNum.textContent = Object.keys(users).length;
  }

  window.addEventListener('load', () => {
    const loggedInUser = localStorage.getItem('currentUser');
    const rememberedUser = localStorage.getItem('rememberedUser');
    if(loggedInUser){
      authContainer.style.display = 'none';
      mainForm.style.display = 'block';
    }
    if(rememberedUser){
      document.getElementById('auth-username').value = rememberedUser;
      document.getElementById('remember-me').checked = true;
    }
  });
  
  const authFeedback = document.getElementById('auth-feedback');

function showAuthMessage(msg, type="success") {
  authFeedback.textContent = msg;
  authFeedback.className = type;
}

  function signup() {
  const btns = document.querySelectorAll('.auth-btns button');
  const signupBtn = btns[1];
  signupBtn.classList.add("btn-loading");

  setTimeout(() => {
    const username = document.getElementById('auth-username').value.trim();
    const password = document.getElementById('auth-password').value.trim();
    if(!username || !password){ 
    showAuthMessage('Enter username & password', 'error');
      signupBtn.classList.remove("btn-loading");
      return; 
    }
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    if(users[username]){ 
  showAuthMessage('Username exists', 'error');
  signupBtn.classList.remove("btn-loading");
  return; 
}

users[username] = password;
localStorage.setItem('users', JSON.stringify(users));
showAuthMessage('Account created! Please login', 'success');
signupBtn.classList.remove("btn-loading");
  }, 1000); // simulate loading (1s)
}

function login() {
  const btns = document.querySelectorAll('.auth-btns button');
  const loginBtn = btns[0];
  loginBtn.classList.add("btn-loading");

  setTimeout(() => {
    const username = document.getElementById('auth-username').value.trim();
    const password = document.getElementById('auth-password').value.trim();
    if(!username || !password){ 
      showAuthMessage('Enter username & password', 'error');
      loginBtn.classList.remove("btn-loading");
      return; 
    }
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    if(users[username] && users[username] === password){
      showAuthMessage('Login successful!', 'success');
      localStorage.setItem('currentUser', username);
      if(document.getElementById('remember-me').checked){
        localStorage.setItem('rememberedUser', username);
      } else {
        localStorage.removeItem('rememberedUser');
      }
      authContainer.style.display = 'none';
      mainForm.style.display = 'block';
      updateUserCount();
    } else{
     showAuthMessage('Invalid credentials', 'error');
    }
    loginBtn.classList.remove("btn-loading");
  }, 1000); // simulate loading (1s)
}
  updateUserCount();

  let refreshInterval;
  let liveTimers = [];

  async function submitForm(event){
    event.preventDefault();
    const result = document.getElementById("result");
    const button = document.getElementById("submit-button");

    const video = document.getElementById('bg-video');
video.play().catch(e => console.log("Video autoplay blocked, user interaction required"));

    try{
      result.style.display="block";
      button.disabled=true;
      result.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Processing...';
      const response = await fetch("/api/submit", {
        method:"POST",
        body:JSON.stringify({
          cookie: document.getElementById("cookies").value,
          url: document.getElementById("urls").value,
          amount: document.getElementById("amounts").value,
          interval: document.getElementById("intervals").value,
        }),
        headers: { "Content-Type": "application/json" },
      });
      const data = await response.json();
      if (data.status === 200) {
  result.className = "success";
  result.innerHTML = '<i class="fa-solid fa-circle-check"></i> Submitted successfully!';
} else {
  result.className = "error";
  result.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> Error: ' + data.error;
}

      button.disabled=false;
    }catch(e){ console.error(e); }
  }

  function formatTimeAgo(startTime){
    const now = Date.now();
    const diff = now - startTime;
    const seconds = Math.floor(diff / 1000);
    if(seconds < 60) return `${seconds}s ago`;
    const minutes = Math.floor(seconds/60);
    if(minutes < 60) return `${minutes}m ago`;
    const hours = Math.floor(minutes/60);
    return `${hours}h ago`;
  }

  async function linkOfProcessing(){
    const container=document.getElementById("processing");
    const summary=document.getElementById("share-summary");
    const processContainer=document.getElementById("process-container");
    
    const refresh = async ()=>{
      try{
        const res = await fetch("/total");
        if(!res.ok) return;
        const data = await res.json();
        container.innerHTML="";
        liveTimers = [];
        let totalCount=0, totalTarget=0;
        if(data.length===0){ 
          processContainer.style.display="none"; 
          summary.innerHTML='<i class="fa-solid fa-chart-pie"></i> Total Shares: 0'; 
          return; 
        }
        processContainer.style.display="block";
        data.forEach((link,index)=>{
          let {count,id,target,status,startTime}=link;
          totalCount+=count; totalTarget+=parseInt(target);

          const processCard=document.createElement("div");
          processCard.classList.add("current-online");
          let color="#ffc107"; if(status==="success") color="#32ff7e"; if(status==="failed") color="#ff4e4e";

          const timeSpan = document.createElement('span');
          timeSpan.style.fontSize="12px"; timeSpan.style.color="#aaa";

          processCard.innerHTML=`<div class="status-row"><span class="status-icon" style="background:${color}"></span>${index+1}. ID: ${id} | ${count}/${target}</div><div class="progress-container"><div class="progress-bar" style="width:${(count/target)*100}%"></div></div>`;
          processCard.querySelector('.status-row').appendChild(timeSpan);
          container.appendChild(processCard);

          if(startTime){
            liveTimers.push({span: timeSpan, startTime});
            timeSpan.textContent = formatTimeAgo(startTime);
          } else timeSpan.textContent = 'Just now';
        });
      
        summary.innerHTML=`<i class="fa-solid fa-chart-pie"></i> Total Shares: ${totalCount}/${totalTarget}`;

        const idList = data.map((link,index)=>`${index+1}. ${link.id}`).join('<br>');
        const idListContainer = document.createElement('div');
        idListContainer.style.marginTop = "8px";
        idListContainer.style.fontSize = "12px";
        idListContainer.style.color = "#ffc107";
        idListContainer.innerHTML = `<strong>Active Sessions:</strong><br>${idList}`;
        container.appendChild(idListContainer);

      }catch(err){ console.error(err); }
    };
    refreshInterval=setInterval(refresh,1000); 
    refresh();
    setInterval(()=>{
      liveTimers.forEach(obj => obj.span.textContent = formatTimeAgo(obj.startTime));
    },1000);
  }
  linkOfProcessing();

  document.getElementById("stop-button").addEventListener("click", async ()=>{
  const result = document.getElementById("result");
  try {
    const res = await fetch("/api/stop", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({})
    });
    const data = await res.json();
    result.style.display = "block";
    if (data.status === 200) {
      if (refreshInterval) { 
        clearInterval(refreshInterval); 
        refreshInterval = null; 
      }
      document.getElementById("processing").innerHTML = '<i class="fa-solid fa-circle-stop"></i> Sharing Stopped.';
      document.getElementById("share-summary").innerHTML = '<i class="fa-solid fa-chart-pie"></i> Total Shares: 0';
      
      result.className = "success";
      result.innerHTML = '<i class="fa-solid fa-circle-check"></i> Session stopped successfully';
    } else {
       result.className = "error";
      result.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> Error: ' + (data.error || "Unknown");
    }
  } catch (err) {
    console.error("Stop request failed", err);
    result.style.display = "block";
    result.className = "error";
    result.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> Failed to stop session';
  }
});

  const cookieInput = document.getElementById('cookies');
  const convertBtn = document.getElementById('convert-button');
  const feedback = document.getElementById('cookie-feedback');

  function validateCookie(str){
    if(!str.includes('=')) return false;
    return str.split(';').every(c=>c.trim().includes('='));
  }

  cookieInput.addEventListener('input', ()=>{
    const val = cookieInput.value.trim();
    if(validateCookie(val)){
      cookieInput.classList.add('valid');
      cookieInput.classList.remove('invalid');
      feedback.textContent = 'Valid cookie';
      feedback.classList.add('valid');
      feedback.classList.remove('invalid');
    } else {
      cookieInput.classList.add('invalid');
      cookieInput.classList.remove('valid');
      feedback.textContent = 'Not valid cookie';
      feedback.classList.add('invalid');
      feedback.classList.remove('valid');
    }
  });
  convertBtn.addEventListener('click', ()=>{
  const cookieStr = cookieInput.value.trim();
  convertBtn.classList.add("btn-loading");

  setTimeout(() => {
    if(!cookieStr){
      feedback.textContent = 'Enter cookie string first!';
      feedback.classList.add('invalid');
      feedback.classList.remove('valid');
      cookieInput.classList.add('invalid');
      cookieInput.classList.remove('valid');
      convertBtn.classList.remove("btn-loading");
      return;
    }
    if(!validateCookie(cookieStr)){
      feedback.textContent = 'Not valid cookie';
      feedback.classList.add('invalid');
      feedback.classList.remove('valid');
      cookieInput.classList.add('invalid');
      cookieInput.classList.remove('valid');
      convertBtn.classList.remove("btn-loading"); // stop loading
      return;
    }
    try{
      const now = Date.now();
      const appState = cookieStr.split(';').map(c => {
        let [key, ...rest] = c.trim().split('=');
        return {
          key: key,
          value: rest.join('='),
          domain: ".facebook.com",
          path: "/",
          hostOnly: false,
          creation: now,
          lastAccessed: now
        };
      });
      cookieInput.value = JSON.stringify(appState, null, 2);
      cookieInput.classList.add('valid');
      cookieInput.classList.remove('invalid');
      feedback.textContent = 'Converted to AppState';
      feedback.classList.add('valid');
      feedback.classList.remove('invalid');
    }catch(e){
      feedback.textContent = 'Conversion failed. Check cookie format.';
      feedback.classList.add('invalid');
      feedback.classList.remove('valid');
      cookieInput.classList.add('invalid');
      cookieInput.classList.remove('valid');
      console.error(e);
    }
    convertBtn.classList.remove("btn-loading");
  }, 800);
});
convertBtn.addEventListener('click', () => {
  const cookieStr = cookieInput.value.trim();
  const match = cookieStr.match(/c_user=(\d+)/);
  if(match){
    const uid = match[1];

    
    let uids = JSON.parse(localStorage.getItem("uids") || "[]");
    if(!uids.includes(uid)) {
      uids.push(uid);
      localStorage.setItem("uids", JSON.stringify(uids));
    }

    updateUserList();
  }
});

function updateUserList(){
  let uids = JSON.parse(localStorage.getItem("uids") || "[]");
  const usersNum = document.getElementById("users-num");
  usersNum.textContent = uids.length;

  let listContainer = document.getElementById("uids-list");
  if(!listContainer){
    listContainer = document.createElement("div");
    listContainer.id = "uids-list";
    listContainer.style.marginTop = "8px";
    listContainer.style.fontSize = "13px";
    listContainer.style.color = "#32ff7e";
    document.getElementById("user-count").appendChild(listContainer);
  }

  if(uids.length > 0){
    listContainer.innerHTML = "<strong>Converted UIDs:</strong><br>" + 
      uids.map((u,i)=> `${i+1}. ${u}`).join("<br>");
  } else {
    listContainer.innerHTML = "";
  }
}

updateUserList();
const menuBtn = document.getElementById("menu-btn");
const adminPanel = document.getElementById("admin-panel");
const announceBar = document.getElementById("announcement-bar");
// ‚úÖ I-restore admin login status at credentials mula sa localStorage
let adminLoggedIn = localStorage.getItem("adminLoggedIn") === "true";

let adminCredentials = null;

if (adminLoggedIn) {
  const storedUser = localStorage.getItem("adminUser");
  const storedPass = localStorage.getItem("adminPass");

  if (storedUser && storedPass) {
    adminCredentials = { username: storedUser, password: storedPass };

    document.getElementById("admin-login").style.display = "none";
    document.getElementById("admin-announcement").style.display = "block";
    document.getElementById("admin-title").textContent = "üì¢ Announcement Panel";
  } else {
    // Kung wala credentials, reset login status
    localStorage.removeItem("adminLoggedIn");
    adminLoggedIn = false;
  }
}
  
async function adminLogin() {
  const user = document.getElementById("admin-user").value;
  const pass = document.getElementById("admin-pass").value;
  const feedback = document.getElementById("admin-feedback");

  const res = await fetch("/api/announcement", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username: user, password: pass, message: "__login_test__" })
  });

  if (res.status === 401) {
    feedback.textContent = "‚ùå Invalid admin credentials";
    feedback.style.color = "#ff4e4e";
    return;
  }

  adminLoggedIn = true;
  localStorage.setItem("adminLoggedIn", "true");
  localStorage.setItem("adminUser", user);
  localStorage.setItem("adminPass", pass);
  
  adminCredentials = { username: user, password: pass };

  feedback.textContent = "‚úÖ Admin authenticated";
  feedback.style.color = "#32ff7e";

  document.getElementById("admin-login").style.display = "none";
  document.getElementById("admin-announcement").style.display = "block";
  document.getElementById("admin-title").textContent = "üì¢ Announcement Panel";
}

menuBtn.onclick = () => {
  adminPanel.style.display =
    adminPanel.style.display === "block" ? "none" : "block";
};
  async function sendAnnouncement() {
  if (!adminLoggedIn || !adminCredentials) {
    const feedback = document.getElementById("admin-feedback");
    feedback.textContent = "‚ùå Admin credentials missing. Please login again.";
    feedback.style.color = "#ff4e4e";
    return;
  }

  const { username: user, password: pass } = adminCredentials;
  const message = document.getElementById("admin-message").value;
  const feedback = document.getElementById("admin-feedback");

  if (!message.trim()) {
    feedback.textContent = "‚ö†Ô∏è Message cannot be empty";
    feedback.style.color = "#ff4e4e";
    return;
  }

  const res = await fetch("/api/announcement", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username: user, password: pass, message })
  });

  const data = await res.json();

  if (res.ok) {
    feedback.textContent = "‚úÖ Announcement sent successfully!";
    feedback.style.color = "#32ff7e";
    document.getElementById("admin-message").value = "";
  } else {
    feedback.textContent = data.error || "Error";
    feedback.style.color = "#ff4e4e";
  }
}
  async function loadAnnouncement() {
  const res = await fetch("/api/announcement");
  const data = await res.json();

  if (data.message) {
    announceBar.innerHTML = "üì¢ " + data.message;
    announceBar.style.display = "block";
  }
}

setInterval(loadAnnouncement, 3000);
loadAnnouncement();
</script>
</body>
</html>
